version: 1

kind: experiment

inputs:
  - name: config
    is_optional: true
    default: "/root/maskscoring_rcnn/configs/e2e_mask_rcnn_R_50_FPN_1x_polyaxon.yaml"
    type: str
  - name: batch_size_train
    is_optional: true
    default: 8
    type: int
  - name: batch_size_test
    is_optional: true
    default: 8
    type: int
  - name: lr
    is_optional: true
    default: 0.02
    type: float

environment:
  resources:
    gpu:
      requests: 1
      limits: 1

build:
  dockerfile: ./Dockerfile-polyaxon

run:
  cmd:
    - git pull origin master
    - ls -la /root
    - ls -la /root/maskscoring_rcnn
    - ls -la /root/maskscoring_rcnn/configs
    - source entrypoint.sh
    - python3 -W ignore tools/train_net_polyaxon.py \
      --config {{config}} \
      SOLVER.BASE_LR {{lr}} \
      SOLVER.IMS_PER_BATCH {{batch_size_train}} \
      TEST.IMS_PER_BATCH {{batch_size_test}}